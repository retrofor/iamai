# iamai

> é«˜çº§å¼‚æ­¥Pythonè·¨å¹³å°è§„åˆ™é©±åŠ¨æœºå™¨äººæ¡†æ¶

[![Python Version](https://img.shields.io/badge/python-3.11+-blue.svg)](https://python.org)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![AsyncIO](https://img.shields.io/badge/async-await-orange.svg)](https://docs.python.org/3/library/asyncio.html)

iamaiæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¼‚æ­¥Pythonè·¨å¹³å°è§„åˆ™é©±åŠ¨æœºå™¨äººæ¡†æ¶ï¼Œæ”¯æŒå¤æ‚çš„è§„åˆ™å¼•æ“ã€å¤šå¹³å°é€‚é…å™¨ã€æ’ä»¶ç³»ç»Ÿå’Œä¼šè¯ç®¡ç†ã€‚å®ƒç»“åˆäº†ç°ä»£å¼‚æ­¥ç¼–ç¨‹çš„æœ€ä½³å®è·µå’Œé«˜çº§è§„åˆ™å¼•æ“åŠŸèƒ½ï¼Œå¯ä»¥æ»¡è¶³å¤æ‚æœºå™¨äººçš„éœ€æ±‚ã€‚

## âœ¨ ç‰¹æ€§

- ğŸš€ **å¼‚æ­¥ä¼˜å…ˆ**: åŸºäºPython asyncioï¼Œæ”¯æŒé«˜å¹¶å‘å¤„ç†
- ğŸ§  **æ™ºèƒ½è§„åˆ™å¼•æ“**: æ”¯æŒå¤æ‚è§„åˆ™å®šä¹‰ã€æ¡ä»¶è¯„ä¼°å’ŒåŠ¨ä½œæ‰§è¡Œ
- ğŸ”Œ **å¤šå¹³å°æ”¯æŒ**: Discordã€Telegramã€Slackã€Webhookç­‰å¹³å°é€‚é…å™¨
- ğŸ¯ **æ’ä»¶ç³»ç»Ÿ**: å¯æ‰©å±•çš„æ’ä»¶æ¶æ„ï¼Œæ”¯æŒé’©å­å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
- ğŸ’¾ **ä¼šè¯ç®¡ç†**: æ™ºèƒ½ä¼šè¯çŠ¶æ€ç®¡ç†å’ŒæŒä¹…åŒ–å­˜å‚¨
- ğŸ“Š **åˆ†æç›‘æ§**: å†…ç½®æ€§èƒ½ç›‘æ§ã€æ—¥å¿—è®°å½•å’Œé€šçŸ¥ç³»ç»Ÿ
- âš™ï¸ **é…ç½®ç®¡ç†**: çµæ´»çš„YAMLé…ç½®å’Œçƒ­é‡è½½æ”¯æŒ
- ğŸ›¡ï¸ **å®‰å…¨å¯é **: å†…ç½®å®‰å…¨æœºåˆ¶å’Œé”™è¯¯å¤„ç†

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               åº”ç”¨å±‚                    â”‚
â”‚  (æœºå™¨äººå®ä¾‹ã€æ’ä»¶ã€ä¸šåŠ¡é€»è¾‘)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               è§„åˆ™å¼•æ“å±‚                â”‚
â”‚  (è§„åˆ™è¯„ä¼°ã€äº‹å®ç®¡ç†ã€äº‹ä»¶å¤„ç†)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¹³å°é€‚é…å±‚                 â”‚
â”‚  (Discord/Telegram/Slack/Webç­‰é€‚é…å™¨)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¼‚æ­¥æ ¸å¿ƒå±‚                 â”‚
â”‚  (äº‹ä»¶å¾ªç¯ã€å¼‚æ­¥IOã€å¹¶å‘ç®¡ç†)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
pip install iamai
```

### åŸºæœ¬ä½¿ç”¨

1. **åˆ›å»ºé…ç½®æ–‡ä»¶**

```bash
iamai init
```

2. **è¿è¡Œæœºå™¨äºº**

```bash
iamai run
```

3. **åœ¨æ§åˆ¶å°ä¸­æµ‹è¯•**

```
iamai> help
ğŸ¤– iamai å¸®åŠ©ä¿¡æ¯

å¯ç”¨å‘½ä»¤:
â€¢ help/å¸®åŠ© - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯
â€¢ echo <æ–‡æœ¬> - å›æ˜¾æ–‡æœ¬
â€¢ time/æ—¶é—´ - æ˜¾ç¤ºå½“å‰æ—¶é—´
â€¢ stats/ç»Ÿè®¡ - æ˜¾ç¤ºæœºå™¨äººç»Ÿè®¡ä¿¡æ¯
â€¢ ping - æµ‹è¯•æœºå™¨äººå“åº”
```

## ğŸ“ è§„åˆ™å®šä¹‰

### åŸºç¡€è§„åˆ™

```python
from iamai.core.rule_engine import rule, when_all

@rule(
    name="welcome_new_user",
    description="æ¬¢è¿æ–°ç”¨æˆ·åŠ å…¥",
    priority=100,
    tags=["welcome", "user_management"]
)
async def welcome_new_user_rule(ctx):
    if ctx.event.type == "member_join":
        user = ctx.event.user
        channel = ctx.event.channel
        
        await ctx.post(
            channel=channel,
            message=f"ğŸ‰ æ¬¢è¿ {user.display_name or user.name} åŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒºï¼"
        )
        
        await ctx.log_action("welcome_user", user_id=user.id)
```

### é«˜çº§è§„åˆ™

```python
@rule(
    name="spam_detection",
    description="æ£€æµ‹å¹¶å¤„ç†åƒåœ¾ä¿¡æ¯",
    priority=200,
    tags=["moderation", "spam", "security"]
)
async def spam_detection_rule(ctx):
    if ctx.event.type == "message" and ctx.event.message:
        message = ctx.event.message
        user = message.author
        
        # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åœ¨çŸ­æ—¶é—´å†…å‘é€äº†å¤šæ¡æ¶ˆæ¯
        recent_messages = await ctx.find_facts(
            type="message",
            user_id=user.id,
            timestamp__gte=datetime.now() - timedelta(seconds=10)
        )
        
        if len(recent_messages) >= 5:
            await ctx.post(
                channel=message.channel,
                message=f"âš ï¸ {user.mention or user.name}ï¼Œè¯·å‹¿å‘é€åƒåœ¾ä¿¡æ¯ï¼"
            )
            
            await ctx.log_action("spam_detection", user_id=user.id)
```

### å·¥ä½œæµè§„åˆ™

```python
@rule(
    name="customer_support_workflow",
    description="å®¢æˆ·æ”¯æŒå·¥ä½œæµï¼Œè‡ªåŠ¨å¤„ç†æ”¯æŒè¯·æ±‚",
    priority=300,
    tags=["workflow", "customer_support", "automation"]
)
async def customer_support_workflow(ctx):
    if ctx.event.type == "support_request":
        request = ctx.event
        user = request.user
        priority = request.get('priority', 'normal')
        
        # åˆ›å»ºæ”¯æŒå·¥å•
        ticket_id = f"TICKET-{datetime.now().strftime('%Y%m%d%H%M%S')}"
        
        await ctx.assert_fact({
            'type': 'support_ticket',
            'ticket_id': ticket_id,
            'user_id': user.id,
            'priority': priority,
            'status': 'open',
            'created_at': datetime.now()
        })
        
        # å¯åŠ¨ç›‘æ§å·¥ä½œæµ
        workflow_id = await ctx.start_workflow(
            "monitor_support_ticket",
            ticket_id=ticket_id,
            timeout=3600
        )
```

## ğŸ”Œ æ’ä»¶ç³»ç»Ÿ

### åˆ›å»ºè‡ªå®šä¹‰æ’ä»¶

```python
from iamai.core.plugin import Plugin, PluginInfo, plugin_hook

class MyPlugin(Plugin):
    @property
    def info(self) -> PluginInfo:
        return PluginInfo(
            name="my_plugin",
            version="1.0.0",
            description="æˆ‘çš„è‡ªå®šä¹‰æ’ä»¶",
            author="Your Name",
            hooks=['before_event', 'after_event']
        )
    
    @plugin_hook('before_event', priority=100)
    async def before_event(self, event):
        print(f"å¤„ç†äº‹ä»¶: {event.type}")
    
    @plugin_hook('after_event', priority=100)
    async def after_event(self, event, results):
        print(f"äº‹ä»¶å¤„ç†å®Œæˆ: {len(results)} ä¸ªç»“æœ")
```

### å†…ç½®æ’ä»¶

- **AnalyticsPlugin**: ç”¨æˆ·è¡Œä¸ºåˆ†æå’Œæ€§èƒ½ç›‘æ§
- **LoggingPlugin**: è¯¦ç»†çš„æ—¥å¿—è®°å½•å’Œç®¡ç†
- **NotificationPlugin**: å¤šæ¸ é“é€šçŸ¥ï¼ˆé‚®ä»¶ã€Webhookã€Slackç­‰ï¼‰
- **CachePlugin**: æ™ºèƒ½ç¼“å­˜åŠŸèƒ½

## ğŸŒ å¹³å°é€‚é…å™¨

### Discordé€‚é…å™¨

```yaml
adapters:
  - name: "discord"
    class_path: "iamai.adapters.discord.DiscordAdapter"
    enabled: true
    config:
      token: "${DISCORD_TOKEN}"
      intents:
        - "messages"
        - "reactions"
        - "members"
```

### Telegramé€‚é…å™¨

```yaml
adapters:
  - name: "telegram"
    class_path: "iamai.adapters.telegram.TelegramAdapter"
    enabled: true
    config:
      token: "${TELEGRAM_TOKEN}"
```

### Webhooké€‚é…å™¨

```yaml
adapters:
  - name: "webhook"
    class_path: "iamai.adapters.webhook.WebhookAdapter"
    enabled: true
    config:
      host: "0.0.0.0"
      port: 8080
      path: "/webhook"
      secret: "${WEBHOOK_SECRET}"
```

## âš™ï¸ é…ç½®ç®¡ç†

### å®Œæ•´é…ç½®ç¤ºä¾‹

```yaml
# åŸºæœ¬ä¿¡æ¯
name: "Myiamai"
version: "0.1.0"
description: "åŸºäºiamaiçš„æ™ºèƒ½æœºå™¨äºº"

# æ—¥å¿—é…ç½®
log_level: "INFO"
log_file: "logs/iamai.log"

# ä¼šè¯é…ç½®
session_timeout: 86400  # 24å°æ—¶
session_cleanup_interval: 1800  # 30åˆ†é’Ÿ

# è§„åˆ™é…ç½®
rules:
  - module: "iamai.examples.rules.basic_rules"
    enabled: true
  - module: "iamai.examples.rules.advanced_rules"
    enabled: true

# æ’ä»¶é…ç½®
plugins:
  - name: "analytics"
    class_path: "iamai.examples.plugins.analytics.AnalyticsPlugin"
    enabled: true
    config:
      database_url: "sqlite:///analytics.db"

# å¹³å°é€‚é…å™¨é…ç½®
adapters:
  - name: "console"
    class_path: "iamai.adapters.console.ConsoleAdapter"
    enabled: true
    config:
      prompt: "iamai> "
```

## ğŸ“Š ç›‘æ§å’Œåˆ†æ

### è·å–ç»Ÿè®¡ä¿¡æ¯

```python
# è·å–æœºå™¨äººç»Ÿè®¡
stats = await bot.get_stats()
print(f"è¿è¡Œæ—¶é—´: {stats['uptime_seconds']} ç§’")
print(f"æ´»è·ƒä¼šè¯: {stats['sessions']['active_sessions']} ä¸ª")
print(f"è§„åˆ™è¯„ä¼°: {stats['rules']['total_evaluations']} æ¬¡")

# å¥åº·æ£€æŸ¥
health = await bot.health_check()
print(f"ç³»ç»ŸçŠ¶æ€: {health['status']}")
```

### æ€§èƒ½ç›‘æ§

```python
# è·å–è§„åˆ™å¼•æ“æ€§èƒ½ç»Ÿè®¡
rule_stats = bot.rule_engine.get_performance_stats()
print(f"å¹³å‡æ‰§è¡Œæ—¶é—´: {rule_stats['average_execution_time']:.3f} ç§’")
print(f"æ€»è¯„ä¼°æ¬¡æ•°: {rule_stats['total_evaluations']}")

# è·å–äº‹å®åº“ç»Ÿè®¡
fact_stats = await bot.fact_base.get_stats()
print(f"æ´»è·ƒäº‹å®: {fact_stats['active_facts']} ä¸ª")
```

## ğŸ› ï¸ å‘½ä»¤è¡Œå·¥å…·

```bash
# è¿è¡Œæœºå™¨äºº
iamai run

# ä½¿ç”¨æŒ‡å®šé…ç½®æ–‡ä»¶
iamai run -c config.yaml

# åˆ›å»ºé»˜è®¤é…ç½®
iamai init

# éªŒè¯é…ç½®æ–‡ä»¶
iamai validate -c config.yaml

# æ£€æŸ¥çŠ¶æ€
iamai status -c config.yaml
```

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
iamai/
â”œâ”€â”€ core/                 # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ bot.py           # ä¸»æœºå™¨äººç±»
â”‚   â”œâ”€â”€ rule_engine.py   # è§„åˆ™å¼•æ“
â”‚   â”œâ”€â”€ facts.py         # äº‹å®å’Œäº‹ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ session.py       # ä¼šè¯ç®¡ç†
â”‚   â””â”€â”€ plugin.py        # æ’ä»¶ç³»ç»Ÿ
â”œâ”€â”€ adapters/            # å¹³å°é€‚é…å™¨
â”‚   â”œâ”€â”€ base.py         # é€‚é…å™¨åŸºç±»
â”‚   â”œâ”€â”€ console.py      # æ§åˆ¶å°é€‚é…å™¨
â”‚   â”œâ”€â”€ discord.py      # Discordé€‚é…å™¨
â”‚   â”œâ”€â”€ telegram.py     # Telegramé€‚é…å™¨
â”‚   â”œâ”€â”€ slack.py        # Slacké€‚é…å™¨
â”‚   â””â”€â”€ webhook.py      # Webhooké€‚é…å™¨
â”œâ”€â”€ config/              # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ config.py       # é…ç½®ç±»
â”œâ”€â”€ examples/            # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ rules/          # ç¤ºä¾‹è§„åˆ™
â”‚   â””â”€â”€ plugins/        # ç¤ºä¾‹æ’ä»¶
â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
```

### æ‰©å±•å¼€å‘

1. **åˆ›å»ºè‡ªå®šä¹‰é€‚é…å™¨**

```python
from iamai.adapters.base import PlatformAdapter

class MyAdapter(PlatformAdapter):
    async def connect(self):
        # è¿æ¥é€»è¾‘
        pass
    
    async def send_message(self, channel, content, **kwargs):
        # å‘é€æ¶ˆæ¯é€»è¾‘
        pass
```

2. **åˆ›å»ºè‡ªå®šä¹‰è§„åˆ™**

```python
from iamai.core.rule_engine import Rule, RuleCondition, RuleAction

def my_rule_handler(ctx):
    # è§„åˆ™å¤„ç†é€»è¾‘
    pass

my_rule = Rule(
    name="my_rule",
    description="æˆ‘çš„è‡ªå®šä¹‰è§„åˆ™",
    conditions=[RuleCondition("event.type == 'message'")],
    actions=[RuleAction(my_rule_handler, "handle_message")],
    priority=100
)
```

## ğŸ“š æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹æŒ‡å—](docs/quickstart.md)
- [è§„åˆ™å¼•æ“è¯¦è§£](docs/rule-engine.md)
- [æ’ä»¶å¼€å‘æŒ‡å—](docs/plugin-development.md)
- [å¹³å°é€‚é…å™¨å¼€å‘](docs/adapter-development.md)
- [APIå‚è€ƒ](docs/api-reference.md)
- [é…ç½®å‚è€ƒ](docs/configuration.md)

## ğŸ¤ è´¡çŒ®

æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…çš„æ”¯æŒ
- æ„Ÿè°¢å¼€æºç¤¾åŒºæä¾›çš„ä¼˜ç§€åº“å’Œå·¥å…·
- ç‰¹åˆ«æ„Ÿè°¢ Python asyncio å›¢é˜Ÿæä¾›çš„å¼‚æ­¥ç¼–ç¨‹æ”¯æŒ

## ğŸ“ æ”¯æŒ

- ğŸ“§ é‚®ç®±: i@jyunko.cn
- ğŸ› é—®é¢˜åé¦ˆ: [GitHub Issues](https://github.com/retrofor/iamai/issues)
- ğŸ’¬ è®¨è®º: [GitHub Discussions](https://github.com/retrofor/iamai/discussions)

---

**iamai** - è®©æœºå™¨äººå¼€å‘æ›´ç®€å•ã€æ›´å¼ºå¤§ï¼ ğŸš€
